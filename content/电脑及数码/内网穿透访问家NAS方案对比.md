---
title: 内网穿透访问家NAS方案对比
date: 2025-09-28
lastmod: 2025-09-28
tags:
  - 电脑技术
categories: []
draft: false
---

---
## 🤖 Assistant

在群晖 DSM 7.2 上安装和使用 ZeroTier 实现内网穿透访问，主要有两种方法：**使用第三方社区套件**（简单推荐）或**使用 Docker 容器**（更灵活但稍复杂）。以下是详细步骤：

---

### **📌 方法一：使用第三方社区套件（推荐，最简单）**
群晖官方套件中心没有 ZeroTier，但 SynoCommunity 提供了编译好的安装包。**注意：** 该套件兼容 DSM 7.x（包括 7.2）。

#### **步骤 1：添加 SynoCommunity 套件源**
1. **登录群晖 DSM**，打开 **"套件中心"**。
2. **点击右上角 "设置"** > **"套件来源"** > **"新增"**。
3. 填写以下信息：
 * **名称:** `SynoCommunity`
 * **位置:** `https://packages.synocommunity.com`
4. 点击 **"确定"** 保存来源。

#### **步骤 2：安装 ZeroTier 套件**
1. 在 **"套件中心"** 中，**搜索 `ZeroTier`**。
2. 找到 **"ZeroTier"**（通常由 SynoCommunity 提供），点击 **"安装"**。
3. 安装完成后，在 **"主菜单"** 中找到并打开 **"ZeroTier"**。

#### **步骤 3：加入你的 ZeroTier 网络**
1. **打开 ZeroTier 应用**，界面会显示本机的 ZeroTier 节点 ID（类似 `abcdef12345`）。
2. 登录 **ZeroTier 官网中央网络管理面板 ([https://my.zerotier.com](https://my.zerotier.com))**。
3. 找到你要加入的 **Network ID**（或创建新网络）。
4. 在 "Members" 标签页下，**输入群晖的节点 ID** 并勾选 ✅ 该设备授权加入网络。
5. 稍等片刻（通常 10-30 秒），刷新页面，在 "Managed IPs" 列会收到群晖自动分配的虚拟内网 IP（如 `192.168.192.45`），记下该 IP。

#### **步骤 4：访问 NAS**
1. 在**外部网络**的设备（电脑/手机）上安装 ZeroTier 客户端，并加入同一个 Network ID。
2. 在 ZeroTier 官网授权该设备的访问权限。
3. 在外部设备上使用 **群晖的虚拟 IP 直接访问服务**（如浏览器输入 `192.168.192.45:5000` 访问 DSM）。

---

### **🐳 方法二：通过 Docker 安装（更灵活）**
适合已使用 Docker 或有自定义配置需求的用户。

#### **步骤 1：安装 Docker**
1. 若未安装，在 **"套件中心"** 搜索安装 **Docker**。

#### **步骤 2：创建 ZeroTier 容器**
1. 打开 **Docker** 应用，进入 **"注册表"** 搜索 `zerotier/zerotier-synology`（专为群晖优化的镜像）或官方 `zerotier/one`。
2. 下载镜像。
3. 下载完成后，进入 **"映像"** 启动该镜像创建容器：
 * **高级设置** 需配置：
 * **存储空间** -> **添加文件夹**：
 * `容器路径`：`/var/lib/zerotier-one`
 * `主机路径`：选择 NAS 本地路径（如 `/docker/zerotier`），用于保存配置。
 * **网络**：
 * 勾选 **"使用与 Docker Host 相同的网络"**（相当于 `host` 网络模式），**这是关键！**
 * **环境变量**：
 * 添加变量 `JOIN_NETWORKS`，值填写你的 **ZeroTier Network ID**（多个用逗号分隔）。
4. 完成配置后启动容器。

#### **步骤 3：授权设备并获取虚拟 IP**
1. 在 ZeroTier 官网的 Network 管理中，**等待容器自动加入网络**（约 1-2 分钟）。
2. 找到新的设备节点 ID（或查看 Docker 容器日志获取），**勾选授权** ✅。
3. 获得群晖分配的虚拟 IP。

#### **步骤 4：测试访问**
1. 在外部设备加入同一 ZeroTier 网络后，即可通过虚拟 IP 访问 NAS 服务。

---

### **🔥 关键配置：允许 ZeroTier 流量通过防火墙**
无论使用哪种安装方式，都需在群晖防火墙设置放行 ZeroTier 虚拟网卡：

1. 进入 **"控制面板" > "安全性" > "防火墙"**。
2. 点击 **"编辑规则" > "创建"**。
3. 选择规则：
 * **端口**：`来源 IP` 选择 **"指定 IP -> CIDR"** 填写 ZeroTier 的虚拟网段（如 `192.168.192.0/24`）。
 * **端口**：`协议` 选择 **"所有端口"**。
 * **操作**：选择 **"允许"**。
4. 保存规则并确保处于启用状态。

```mermaid
graph LR
    A[外部设备] -->|ZeroTier 加密流量| B[ZeroTier 全球网络]
    B --> C[你的 ZeroTier 网络ID]
    C --> D[群晖NAS]
    D --> E[通过虚拟IP访问DSM/文件服务等]
```

---

### **⚡ 使用技巧与注意事项**
1. **节点授权**：每次新设备加入都需在官网手动勾选授权。
2. **IP 固定**：在 ZeroTier 后台可锁定虚拟 IP 避免变动（勾选设备后的 `Auth?` 下方）。
3. **禁用默认中继**：若 P2P 直连失败，流量会经过 ZeroTier 官方服务器（海外节点可能慢），可自建 **Moon 节点**优化国内连接（需一台国内 VPS）。
4. **iOS/Android 客户端**：需在设置中开启 **"Allow Cellular Data"** 和 **"Allow LAN Access"**，确保在移动网络下可访问 NAS。

---

✅ **最终效果**：手机/电脑加入 ZeroTier 网络后，**如同身处家中局域网**，直接输入群晖的虚拟 IP（如 `192.168.192.45:5000`）即可远程管理 DSM、访问文件或影音库，速度和安全性远胜于商业穿透工具（非对称 NAT 下仍可能走中继）。

> 提示：若遇到连接问题，可在群晖命令行运行 `zerotier-cli listnetworks`（套件版）或 `docker exec [容器名] zerotier-cli listnetworks`（Docker 版）查看网络状态，其中 `OK` 代表已连接成功。
